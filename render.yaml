services:
  - type: web
    name: lenny-search-api
    runtime: docker
    repo: https://github.com/JackShenYangHsuan/yt-transcript-retrieval
    buildCommand: |
      apt-get update && apt-get install -y git-lfs
      git lfs install
      git lfs pull
    dockerfilePath: ./Dockerfile.render
    dockerContext: .
    region: oregon
    plan: standard  # $25/mo, always-on
    healthCheckPath: /health
    envVars:
      - key: DATA_DIR_OVERRIDE
        value: /app/data
      - key: EMBEDDING_PROVIDER
        value: openai
      - key: EMBEDDING_MODEL
        value: text-embedding-3-small
      - key: USE_RERANKER
        value: "true"  # Re-enabled with Qdrant Cloud (~1.2-1.7GB total)
      - key: BM25_LIGHTWEIGHT_MODE
        value: "true"  # Lightweight mode to reduce memory
      - key: QDRANT_URL
        value: https://5b26d6b2-5bd8-4dfe-8fb2-b551bc039ab6.us-west-1-0.aws.cloud.qdrant.io
      - key: QDRANT_API_KEY
        sync: false  # Set manually in Render dashboard
      - key: OPENAI_API_KEY
        sync: false  # Set manually in Render dashboard
    disk:
      name: search-data
      mountPath: /app/data
      sizeGB: 1  # ~535MB indexes + room to grow
