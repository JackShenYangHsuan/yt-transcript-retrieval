services:
  - type: web
    name: lenny-search-api
    runtime: docker
    repo: https://github.com/JackShenYangHsuan/yt-transcript-retrieval
    buildCommand: |
      apt-get update && apt-get install -y git-lfs
      git lfs install
      git lfs pull
    dockerfilePath: ./Dockerfile.render
    dockerContext: .
    region: oregon
    plan: standard  # $25/mo, always-on
    healthCheckPath: /health
    envVars:
      - key: DATA_DIR_OVERRIDE
        value: /app/data
      - key: EMBEDDING_PROVIDER
        value: openai
      - key: EMBEDDING_MODEL
        value: text-embedding-3-small
      - key: USE_RERANKER
        value: "false"  # Disabled to stay under 2GB RAM limit
      - key: BM25_LIGHTWEIGHT_MODE
        value: "true"  # Don't load chunk metadata, saves ~100MB memory
      - key: OPENAI_API_KEY
        sync: false  # Set manually in Render dashboard
    disk:
      name: search-data
      mountPath: /app/data
      sizeGB: 1  # ~535MB indexes + room to grow
